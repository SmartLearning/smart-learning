timeout: 1200
machine:
    services:
        - docker
    java:
        version: oraclejdk8
    node:
        version: 6.11.0
dependencies:
    cache_directories:
        - "$APP_DIR/node_modules"
        - "$APP_DIR/src/main/webapp/bower_components"
        - "$APP_DIR/gradle-cache"
        - "$APP_DIR/.gradle"
        - "$APP_DIR/.yarn-cache"
        - "~/.gradle"
        - "~/.yarn-cache"
        - "~/.m2"
        - "~/.cache/bower"
    override:
        - java -version
        # Repo for Yarn
        - curl -o- -L https://yarnpkg.com/install.sh | bash
        - export PATH=/home/ubuntu/.yarn/bin:$PATH
        - yarn global add bower gulp-cli gulp
        - cd $APP_DIR && yarn install
test:
    override:
        - chmod +x ./gradlew
        - chmod +x $APP_DIR./gradlew
        - cd $APP_DIR && ./gradlew clean test --no-daemon
        - cd $APP_DIR && gulp test
        - cd $APP_DIR && ./gradlew -Pprod clean test --no-daemon
        - cd $APP_DIR && gulp build
        - cd $APP_DIR && ./gradlew -Pprod stage -x test --no-daemon